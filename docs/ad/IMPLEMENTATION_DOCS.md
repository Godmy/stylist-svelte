# Документация: Реализация компонентов GraphQL-визуализатора для Svelte 5 Runes

## Введение

В рамках данного проекта была реализована библиотека компонентов для визуализации GraphQL-схем, предназначенная для использования в Svelte 5 с применением системы управления состоянием Runes. Реализация соответствует архитектурным решениям, зафиксированным в ADR-файлах проекта stylist-svelte, и следует методологии Atomic Design.

## Цели и задачи

### Цель
Создать набор переиспользуемых компонентов для визуализации GraphQL-схем, которые:
- Обеспечивают интуитивное понимание структуры схемы
- Позволяют исследовать связи между различными типами
- Предоставляют возможность фильтрации, поиска и экспорта визуализаций
- Используют современные подходы Svelte 5 (Runes)

### Задачи
1. Реализовать атомарные компоненты для базовой отрисовки элементов визуализации
2. Создать молекулярные компоненты для более сложных элементов интерфейса
3. Разработать организменные компоненты для полнофункциональных частей интерфейса
4. Обеспечить обратную связь пользователю через соответствующие компоненты
5. Создать типы данных для работы с GraphQL-схемами и визуализацией

## Архитектура компонентов

Реализованные компоненты организованы по методологии Atomic Design:

### Атомы
- `GraphNode.svelte` - визуальное представление отдельного GraphQL-типа
- `GraphEdge.svelte` - линия соединения между типами
- `VisualizationCanvas.svelte` - основной холст для визуализации
- `Label.svelte` - компонент для отображения текста
- `Icon.svelte` - иконки для различных типов GraphQL

### Молекулы
- `GraphNodeCard.svelte` - карточка узла с расширенной информацией
- `LegendItem.svelte` - элемент легенды для типа
- `SearchBar.svelte` - панель поиска
- `FilterPanel.svelte` - панель фильтров
- `Toolbar.svelte` - панель инструментов

### Организмы
- `VisualizationCanvas.svelte` - основной компонент визуализации со всеми элементами управления
- `LegendPanel.svelte` - панель легенды с информацией о типах
- `ControlPanel.svelte` - централизованная панель управления
- `GraphNodeDetails.svelte` - подробная информация об узле
- `SchemaExplorer.svelte` - обозреватель структуры схемы
- `ExportPanel.svelte` - панель для экспорта визуализаций

### Компоненты обратной связи
- `LoadingOverlay.svelte` - оверлей загрузки
- `ErrorMessage.svelte` - компонент для отображения ошибок

## Технические особенности

### Использование Svelte 5 Runes
Все компоненты используют новую систему управления состоянием Svelte 5:
- `$state()` для локального состояния компонентов
- `$derived()` для вычисляемых значений
- `$effect()` для побочных эффектов
- `$props()` для пропсов компонентов

### Типизация
Создана система типов для работы с GraphQL-схемами и визуализацией в файле `src/lib/types/graphql-visualizer.ts`:
- `GraphNode` - тип для узлов визуализации
- `GraphEdge` - тип для ребер визуализации
- `GraphVisualizationData` - тип для всей визуализации
- `SchemaIntrospectionResult` - тип для результатов интроспекции GraphQL
и другие

### Адаптивность и пользовательский интерфейс
- Поддержка масштабирования и панорамирования холста
- Различные макеты (force-directed, hierarchical, circular, grid)
- Фильтрация типов и поисковые возможности
- Подробные представления узлов
- Экспорт в различные форматы (PNG, JPEG, SVG, PDF)

## Пример использования

Компонент `VisualizationCanvas` может быть использован следующим образом:

```svelte
<script lang="ts">
  import { VisualizationCanvas } from '$lib/components/organisms';
  import type { GraphVisualizationData } from '$lib/types';

  let sampleData: GraphVisualizationData = {
    nodes: [
      { id: '1', name: 'User', type: 'object', position: { x: 100, y: 100 } },
      { id: '2', name: 'Post', type: 'object', position: { x: 300, y: 200 } }
    ],
    edges: [
      { id: 'e1', source: '1', target: '2', type: 'field', label: 'posts' }
    ]
  };
</script>

<VisualizationCanvas 
  {data={sampleData}}
  {showToolbar=true}
  {showLegend=true}
  {showSearch=true}
  {showFilter=true}
/>
```

## Интеграция в систему документации

Создан файл истории (story) в формате Histoire (`stories/VisualizationCanvas.story.svelte`) для демонстрации компонентов и их вариантов использования.

## Заключение

Реализованные компоненты предоставляют полный набор инструментов для визуализации GraphQL-схем в Svelte 5 приложениях. Архитектура компонентов обеспечивает гибкость, расширяемость и соответствие современным подходам разработки UI-компонентов. Компоненты готовы к использованию в проекте stylist-svelte и могут быть легко интегрированы в любое приложение, требующее визуализации GraphQL-схем.